<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org" lang="en">

<head>
    <div th:replace="~{fragment :: TheHeader(${pageTitle})}"></div>
    <style>
        .form-container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }


        .form-control:focus {
            border-color: #022e64;
            box-shadow: none;
        }


    </style>
</head>


<body data-bs-theme="dark">
<div th:replace="~{fragment/header :: header}"></div>

<div class="form-container" data-bs-theme="dark">
    <h2 class="text-center my-5"><i class="fa-duotone fa-bars"></i>[[${title}]]</h2>


    <div class="d-flex align-items-start">
        <form th:action="@{/orders/saving}" method="post" data-bs-theme="dark" th:object="${order}">

            <br>
            <h2 class="text-success">First Phase</h2>

            <div class="form-group mb-3">
                <label for="id">ID</label>
                <input type="text" id="id" class="form-control" th:value="*{id}" readonly>
            </div>

            <div class="form-group mb-3">
                <label for="customer-name">Customer Name</label>
                <input type="text" id="customer-name" class="form-control"
                       th:value="*{customer.fullName}" readonly>
            </div>

            <div class="form-group mb-3">
                <label for="product-price">Product Price</label>
                <input type="text" id="product-price" class="form-control"
                       th:value="*{productPrice}" readonly>
            </div>

            <div class="form-group mb-3">
                <label for="inter-sum">InterSum</label>
                <input type="text" id="inter-sum" class="form-control" th:value="*{interSum}"
                       readonly>
            </div>

            <div class="form-group mb-3">
                <label for="shipping-charge">Shipping Charge</label>
                <input type="text" id="shipping-charge" class="form-control"
                       th:value="*{shippingCharge}" readonly>
            </div>

            <div class="form-group mb-3">
                <label for="vat">VAT</label>
                <input type="text" id="vat" class="form-control" th:value="*{VAT}" readonly>
            </div>

            <div class="form-group mb-3">
                <label for="total-price">Total Price</label>
                <input type="text" id="total-price" class="form-control"
                       th:value="*{totalPrice}" readonly>
            </div>

            <div class="form-group mb-3">
                <label for="payment-choice">Payment Choice</label>
                <select id="payment-choice" th:field="*{paymentChoice}" class="form-control"
                        required>
                    <option th:each="choice : ${T(com.lumosshop.common.entity.order.Payment_Choice).values()}"
                            th:value="${choice}" th:text="${choice}"></option>
                </select>
            </div>

            <div class="form-group mb-3">
                <label for="order-phase">Order Phase</label>
                <select id="order-phase" th:field="*{phase}" class="form-control" required>
                    <option th:each="phase : ${T(com.lumosshop.common.entity.order.Order_Phase).values()}"
                            th:value="${phase}" th:text="${phase}"></option>
                </select>
            </div>

            <br>
            <h2 class="text-success">Second Phase</h2>
            <th:block th:each="order, status : ${order.orderSummaries}">
                <div class="border rounded p-1" th:id="'row' + ${status.count}">
                    <div class="row">
                        <div class="col-1">
                            <div class="divCount">[[${status.count}]]</div>
                        </div>
                        <div class="col-3">
                            <img th:src="@{${order.product.mainImagePath}}" class="img-fluid" alt="stockPhoto"/>
                        </div>
                    </div>

                    <div class="row m-2">
                        <b>[[${order.product.name}]]</b>
                    </div>
                    <div class="row m-2">
                        <table>
                            <tr>
                                <td>product price (cost)</td>
                                <td>
                                    <input type="text" required class="form-control m-1"
                                           name="productCost"
                                           th:rowNumber="${status.count}"
                                           th:value="${order.productPrice}"/>

                                </td>
                            </tr>
                            <tr>
                                <td>Qty</td>
                                <td>

                                    <input type="number" step="1" min="1" max="5"
                                           class="form-control m-1 "
                                           name="quantity"
                                           th:id="'qty' + ${status.count}"
                                           th:rowNumber="${status.count}"
                                           th:value="${order.qty}"/>
                                </td>
                            </tr>
                            <tr>
                                <td>item price</td>
                                <td>
                                    <input type="text" required class="form-control m-1"
                                           name="itemPrice"
                                           th:id="'itemprice' + ${status.count}"
                                           th:rowNumber="${status.count}"
                                           th:value="${order.itemPrice}"/>
                                </td>
                            </tr>
                            <tr>
                                <td>InterSum</td>
                                <td>
                                    <input type="text" readonly="readonly"
                                           class="form-control m-1"
                                           name="productInterSum"
                                           th:id="'InterSum' + ${status.count}"
                                           th:value="${order.interSum}"/>
                                </td>
                            </tr>
                            <tr>
                                <td>shipping charge</td>
                                <td>
                                    <input type="text" required class="form-control m-1"
                                           name="productShipCharge"
                                           th:value="${order.shippingCharge}"/>
                                </td>
                            </tr>
                        </table>
                    </div>

                </div>

            </th:block>

            <br>
            <h2 class="text-success">third Phase</h2>


            <div class="form-group row mb-2">
                <label class="col-4 col-form-label">order date</label>
                <div class="col-8">
                    <input type="text" readonly class="form-control" th:value="${order.orderDate}">
                </div>
            </div>
            <div class="form-group row mb-2">
                <label class="col-4 col-form-label">Deliver date</label>
                <div class="col-8">
                    <input type="text" readonly class="form-control" th:value="${order.deliverDate}">
                </div>
            </div>
            <div class="form-group row mb-2">
                <label class="col-4 col-form-label">Firstname</label>
                <div class="col-8">
                    <input type="text" readonly class="form-control" th:value="${order.firstName}">
                </div>
            </div>
            <div class="form-group row mb-2">
                <label class="col-4 col-form-label">Lastname</label>
                <div class="col-8">
                    <input type="text" readonly class="form-control" th:value="${order.lastName}">
                </div>
            </div>
            <div class="form-group row mb-2">
                <label class="col-4 col-form-label">Phone number</label>
                <div class="col-8">
                    <input type="text" readonly class="form-control" th:value="${order.phoneNumber}">
                </div>
            </div>
            <div class="form-group row mb-2">
                <label class="col-4 col-form-label">Address Line 1</label>
                <div class="col-8">
                    <input type="text" readonly class="form-control" th:value="${order.addressLine1}">
                </div>
            </div>
            <div class="form-group row mb-2">
                <label class="col-4 col-form-label">Address Line 2</label>
                <div class="col-8">
                    <input type="text" readonly class="form-control" th:value="${order.addressLine2}">
                </div>
            </div>
            <div class="form-group row mb-2">
                <label class="col-4 col-form-label">City</label>
                <div class="col-8">
                    <input type="text" readonly class="form-control" th:value="${order.city}">
                </div>
            </div>

            <div class="form-group row mb-2">
                <label class="col-4 col-form-label">Nation</label>
                <div class="col-8">
                    <input type="text" readonly class="form-control" th:value="${order.nation}">
                </div>
            </div>

            <br>




        </form>
    </div>
</div>


</div>
<script>
    moduleURL = "[[@{/orders}]]";
    contextPath = "[[@{/}]]";

    let cityList;

    $(document).ready(function () {
        const NationSelector = $("#nation");
        cityList = $("#cityList");
        $("#btn-Cancel").on("click", function () {
            window.location = moduleURL;
        });


        NationSelector.on("change", function () {
            cityFetch();
            $("#city").val("").focus();
        });
    });

    function cityFetch() {
        const chosen = $("#nation option:selected");
        const NationId = chosen.val();
        const URL = contextPath + "city/list/" + NationId;


        $.get(URL, function (responseJSON) {
            cityList.empty();
            $.each(responseJSON, function (index, nation) {
                $("<option>").val(nation.name).text(nation.name).appendTo(cityList);
            });
        });
    }

    function checkEmailUnique(form) {

        url = "[[@{/customer/checkEmail}]]";
        customerEmail = $("#email").val();
        customerId = $("#id").val();
        csrfValue = $("input[name='_csrf']").val();
        params = {id: customerId, email: customerEmail, _csrf: csrfValue};

        $.post(url, params, function (response) {
            if (response === "OK") {
                form.submit();

            } else if (response === "Duplicated") {

                showModalDialog("Warning", "The email address is currently registered to another customer.");

            } else {
                showModalDialog("Error", "The server gave a response we can't identify");
            }

        }).fail(function () {
            showModalDialog("Error", "We're having trouble linking to the server.");

        });
        return false;
    }

    function showModalDialog(title, message) {
        $("#modalTitle").text(title);
        $("#modalBody").text(message);
        $("#modalDialog").modal("show");

    }
</script>

</body>
<footer th:replace="~{fragment/footer :: footer}"></footer>
</html>